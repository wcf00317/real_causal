data:
  type: "cityscapes"
  dataset_path: "/data/chengfengwu/alrl/mtl_dataset/cityscape_preprocess"
  batch_size: 32
  num_workers: 4
  img_size: [128, 256] # Cityscapes 也是 1:2 的比例，这个尺寸训练较快
  pin_memory: true

model:
  type: "causal"
  encoder_name: "resnet50"
  pretrained: True

  # === 核心结构参数 ===
  num_seg_classes: 7
  latent_dim_s: 1024   # 结构维度保持较高以保留细节
  latent_dim_p: 64     # [修改] 降维至 64，强制构建信息瓶颈，防止 Style 泄漏
  z_s_bottleneck_noise: 0.1

  # 物理分解头 (Cityscapes 无 GT 法线，此处作为无监督辅助任务)
  decomposition:
    enabled: true
    normal_head_hidden: 128
    albedo_head_hidden: 128
    light_head:
      sh_degree: 2
      grayscale_prior: true # 户外光照通常比较自然，灰度先验有助于解耦

training:
  seed: 2024
  epochs: 100    # Cityscapes 数据量较大且任务难，建议多跑一些 epoch
  optimizer: "AdamW"
  learning_rate: 0.0002
  weight_decay: 0.0001

  # === 阶段控制 ===
  stage0_epochs: 10     # 稍微延长预热，让无监督的分解先稳定下来
  stage1_epochs: 5
  ind_warmup_epochs: 20 # 晚一点引入 CKA，先让特征学会表达

  lr_scheduler:
    type: "cosine"
    warmup_epochs: 5
    min_lr_factor: 0.01

  # === CFA 反事实增强配置 (如果你使用了新版 Trainer) ===
  cfa:
    enabled: false
    start_epoch: 50
    cka_threshold: 0.1
    prob: 0.5
    lambda_cfa: 1.0
    mix_strategy: "global" # 必须用 global，尤其是在户外场景，防止把天空贴到路面上

losses:
  # === 1. 下游任务 Loss ===
  lambda_seg: 10.0
  lambda_depth: 20.0

  # [重要] Cityscapes 没有真实法线标签，权重必须设为 0
  lambda_normal: 0.0

  lambda_edge_consistency: 0.1

  # === 2. 独立性约束 ===
  lambda_independence: 1.0

  # === 3. 重构 Loss ===
  # 即使没有法线 GT，几何重构 (Zs -> Depth) 依然重要
  alpha_recon_geom: 2.0

  # 图像重构 (A*S = I) 是无监督分解的唯一动力
  beta_recon_app: 5.0  # 加大权重，因为没有法线监督，重构是唯一的约束
  lambda_l1_recon: 2.0

  # === 4. 物理先验 ===
  lambda_img: 5.0      # 物理渲染重构权重
  lambda_alb_tv: 0.1   # 纹理平滑
  lambda_sh_gray: 0.1  # 光照约束
  lambda_xcov: 0.5     # 去相关