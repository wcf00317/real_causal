data:
  type: "gta5_to_cityscapes"
  train_dataset_path: "/data/chengfengwu/alrl/mtl_dataset/gta5/train"
  val_dataset_path: "/data/chengfengwu/alrl/mtl_dataset/cityscape_preprocess"
  source_val_path: "/data/chengfengwu/alrl/mtl_dataset/gta5/val"
  batch_size: 32
  num_workers: 4
  img_size: [128, 256]
  pin_memory: True

model:
  type: "causal"
  encoder_name: "resnet50"
  pretrained: True
  num_seg_classes: 7
  latent_dim_s: 1024
  latent_dim_p: 64
  z_s_bottleneck_noise: 0.1

  decomposition:
    enabled: true
    normal_head_hidden: 128
    albedo_head_hidden: 128
    light_head:
      sh_degree: 2
      grayscale_prior: true

training:
  seed: 2024
  epochs: 100
  optimizer: "AdamW"
  learning_rate: 0.0002
  weight_decay: 0.0001

  # === 阶段控制 ===
  stage0_epochs: 10
  stage1_epochs: 5
  # [平衡策略 1] 独立性预热取中间值 (30)
  # 让 Zs/Zp 在 Epoch 30 开始分离，比20稳，比40快，给 Seg 留出更多优化时间
  ind_warmup_epochs: 30

  lr_scheduler:
    type: "cosine"
    warmup_epochs: 10
    min_lr_factor: 0.01

  # === 反事实增强 (CFA) ===
  cfa:
    enabled: true
    # [平衡策略 2] CFA 启动时机取中间值 (45)
    # 确保 Feature 已经比较成熟后再引入扰动，防止 Depth 崩塌
    start_epoch: 45
    # [平衡策略 3] 稍微降低概率 (0.5 -> 0.4)
    # 减少风格扰动的频率，保护对噪声敏感的 Depth 任务
    prob: 0.4
    lambda_cfa: 5.0
    mix_strategy: "global"

losses:
  # === 任务 Loss ===

  # 1. Seg 保持高位，保住 mIoU SOTA
  lambda_seg: 25.0

  # 2. [平衡策略 4] 提升 Depth 权重 (15.0 -> 20.0)
  # 为了抵抗 CFA 在中期带来的分布冲击，必须给 Depth 更多的话语权
  lambda_depth: 20.0

  lambda_normal: 0.0

  # 3. 必须保持关闭！边缘一致性是导致 Rel Err 飙升的元凶
  lambda_edge_consistency: 0.0

  # === 独立性 Loss ===
  lambda_independence: 0.1

  # === 重构 Loss ===
  # [平衡策略 5] 增强几何重构 (2.0 -> 3.0)
  # 利用 Zs 的纯净性来辅助 Depth 回归
  alpha_recon_geom: 3.0
  beta_recon_app: 2.0
  lambda_l1_recon: 2.0

  # === 物理先验 ===
  lambda_img: 5.0
  lambda_alb_tv: 0.1
  lambda_sh_gray: 0.1
  lambda_xcov: 0.5